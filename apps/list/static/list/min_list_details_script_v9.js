const subscribeButtons=document.querySelectorAll(".subscribeButton");function check_interaction_wrapper_at_last_spot(e,t){(spot=e.querySelectorAll(".contentWrapper").length)%(items_per_screen=getComputedStyle(e.querySelector(".slider")).getPropertyValue("--items-per-screen"))==0&&(t?e.querySelector(".slider").style.zIndex="":e.querySelector(".slider").style.zIndex="1000")}subscribeButtons.forEach(e=>{e&&e.addEventListener("click",async()=>{if(!e.classList.contains("registrationLink"))try{let t=e.closest(".upperContainer").querySelector(".rightFirstRowContainer h3").id.split("#")[1],r=e.innerText,l=await fetch(`../../api/lists/${t}/list_change_subscribtion_status/`,get_fetch_settings("POST"));if(l.ok){let s=await l.json();console.log(r),"Subscribe"==r?(e.classList.replace("unsubscribed","subscribed"),e.innerText="Subscribed",showMessage(s,"Success")):(e.classList.replace("subscribed","unsubscribed"),e.innerText="Subscribe",showMessage(s,"Remove"))}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(o){}})});const editButtons=document.querySelectorAll(".editButton"),listName=document.querySelector(".rightFirstRowContainer h3").innerText;function openEditMenu(e){let t=e.target.closest(".upperContainer");t.querySelector(".editButton").remove(),t.querySelector(".rightFirstRowContainer h3").style.display="none",t.querySelector(".nameChangeContainer").style.display="block",t.querySelector(".nameChangeContainer #id_name").value=listName,t.querySelector(".listPictureContainer #id_list_pic").style.display="block",t.querySelector(".fa-camera").style.display="block",t.querySelector(".buttonContainer").style.display="flex",document.querySelector(".addSourcesButton").style.display="flex",document.querySelectorAll(".highlightedArticlesContainer .article .fa-ellipsis-h").forEach(e=>{e.style.display="none"});let r=document.querySelectorAll(".article .fa-times");r.forEach(e=>{e.style.display="block",e.addEventListener("click",async()=>{try{let r=t.querySelector(".rightFirstRowContainer h3").id.split("#")[1],l=e.parentElement.id.split("#")[1],s=await fetch(`../../api/lists/${r}/delete_article_from_list/${l}/`,get_fetch_settings("DELETE"));if(s.ok){let o=await s.json();showMessage(o,"Remove"),e.parentElement.remove()}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(i){}})}),document.querySelectorAll(".sourceDeleteOption").forEach(e=>{"none"!=e.style.display&&e.style.display||(e.style.display="block",e.addEventListener("click",async()=>{try{let r=t.querySelector(".rightFirstRowContainer h3").id.split("#")[1],l=e.id.split("#")[1],s=await fetch(`../../api/lists/${r}/delete_source_from_list/${l}/`,get_fetch_settings("DELETE"));if(s.ok){let o=await s.json();showMessage(o,"Remove"),e.parentElement.parentElement.remove()}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(i){}}))})}editButtons.forEach(e=>{e&&e.addEventListener("click",e=>{openEditMenu(e)})}),document.querySelector(".deleteListButton")&&document.querySelector(".deleteListButton").addEventListener("click",async()=>{try{let e=document.querySelector(".rightFirstRowContainer h3").id.split("#")[1],t=await fetch(`../../api/lists/${e}/`,get_fetch_settings("DELETE"));if(t.ok){let r=await t.json();showMessage(r,"Remove"),window.location.href="../../lists"}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(l){}}),document.querySelector(".addSourcesButton")&&document.querySelector(".addSourcesButton").addEventListener("click",()=>{document.querySelector(".addSourcesForm").style.display="flex",check_interaction_wrapper_at_last_spot(document.querySelector(".sliderWrapper"),!1)}),document.querySelector(".addSourcesForm .closeFormContainerButton")&&document.querySelector(".addSourcesForm .closeFormContainerButton").addEventListener("click",()=>{document.querySelector(".addSourcesForm").style.display="none",check_interaction_wrapper_at_last_spot(document.querySelector(".sliderWrapper"),!0)});let selected_sources=[];document.querySelector(".addSourcesForm #textInput")&&document.querySelector(".addSourcesForm #textInput").addEventListener("keyup",async function(e){let t=document.querySelector(".addSourcesForm #textInput").value,r=document.querySelector(".addSourcesForm #searchResultsContainer"),l=document.querySelector(".addSourcesForm .selectionContainer"),s=document.querySelector(".rightFirstRowContainer h3").id.split("#")[1];if(t&&""!=t.replaceAll(/\s/g,"")){r.style.display="block",l.style.display="none";try{let o=await fetch(`../../api/sources/?list_search=${t}&list_id=${s}`,get_fetch_settings("GET"));if(o.ok){let i=await o.json();r.innerHTML="";let n=document.createElement("div");n.innerText="Results:",r.append(n),i.length>0&&i.forEach(e=>{if(!1==selected_sources.includes(e.source_id)){let t=document.createElement("div");t.classList.add("searchResult");let s=document.createElement("img");s.src=`https://finbrowser.s3.us-east-2.amazonaws.com/static/${e.favicon_path}`;let o=document.createElement("span");o.innerText=e.name,o.id=`source_id_${e.source_id}`,t.append(s,o),r.appendChild(t),t.addEventListener("click",function s(){t.removeEventListener("click",s),selected_sources.push(e.source_id);let o=document.createElement("i");o.classList.add("fas","fa-trash"),o.addEventListener("click",()=>{o.parentElement.remove(),selected_sources=selected_sources.filter(function(e){return e.toString()!==o.previousElementSibling.id.split("#")[1]})}),t.appendChild(o),l.appendChild(t),r.style.display="none",l.style.display="block",document.querySelector(".addSourcesForm #textInput").value=""})}})}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(a){}}else r.style.display="none",l.style.display="block"}),document.querySelector(".addSourcesForm button")&&document.querySelector(".addSourcesForm button").addEventListener("click",async()=>{let e=document.querySelector(".rightFirstRowContainer h3").id.split("#")[1];if(selected_sources.length){selected_sources=selected_sources.join();try{let t=await fetch(`../../api/lists/${e}/add_sources/${selected_sources}/`,get_fetch_settings("POST"));if(t.ok){let r=await t.json();showMessage(r,"Success"),window.location.reload()}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(l){}}else showMessage("You need to select sources!","Error")});const one=document.getElementById("first"),two=document.getElementById("second"),three=document.getElementById("third"),four=document.getElementById("fourth"),five=document.getElementById("fifth"),confirmBox=document.getElementById("confirm-box"),handleStarSelect=(e,t)=>{let r=t.children;for(let l=0;l<r.length;l++)l<e?r[l].classList.add("checked"):r[l].classList.remove("checked")},handleSelect=e=>{let t=document.querySelector(".rate-form");switch(e){case"first":handleStarSelect(1,t);return;case"second":handleStarSelect(2,t);return;case"third":handleStarSelect(3,t);return;case"fourth":handleStarSelect(4,t);return;case"fifth":handleStarSelect(5,t);return;default:handleStarSelect(0,t)}},getNumericValue=e=>{let t;return"first"===e?1:"second"===e?2:"third"===e?3:"fourth"===e?4:"fifth"===e?5:0};if(one){let e=[one,two,three,four,five];e.forEach(e=>e.addEventListener("mouseover",e=>{handleSelect(e.target.id)}))}if(document.querySelectorAll(".rankingStar").forEach(e=>{e.addEventListener("click",async e=>{let t=e.target.id,r=getNumericValue(t),l=document.querySelector(".rightFirstRowContainer h3").id.split("#")[1];try{let s={list_id:l,rating:r},o=await fetch("../../api/list_ratings/",{method:"POST",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"},mode:"same-origin",body:JSON.stringify(s)});if(o.ok){let i=await o.json();showMessage(i,"Success"),window.location.reload()}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(n){}})}),document.querySelector(".avgRating span")){let t=Math.round(document.querySelector(".avgRating span").innerText);handleStarSelect(t,document.querySelector(".ratedContainer"))}const rateListButtons=document.querySelectorAll(".rateListButton");rateListButtons.forEach(e=>{e&&e.addEventListener("click",()=>{let t=e.closest(".upperContainer");e.classList.contains("registrationLink")||(t.querySelector(".rate-formUpperContainer").style.display="block",t.querySelector(".rating").style.opacity="0",t.querySelector(".ratingsAmmountContainer").style.opacity="0",t.querySelector(".rateListButton").style.opacity="0",t.querySelector(".rankingsHeader").style.opacity="0")})});