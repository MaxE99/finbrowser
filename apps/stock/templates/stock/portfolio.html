{% extends 'home/base.html' %}
{% load static %}
{% load tags %}
{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'stock/min_portfolio_style_v1.css' %}">
{% if request.user.is_authenticated %}
<title>{{ selected_portfolio.name }} | FinBrowser</title>
{% else %}
<title>Portfolio | FinBrowser</title>
{% endif %}
{% endblock %}
{% block content %}


{% if request.user.is_authenticated %}
<div class="portfolioMenuWrapper">
    <div class="menuContainer">
        <div class="addStocksContainer">
            <div class="header addStocksHeader">
                <h2>Add Stocks</h2><i class="fas fa-times closeAddStockContainer"></i>
            </div>
            <div class="actionWrapper">
                <input id="textInput" type="text" autocomplete="off" spellcheck="false">
                <div class="searchResultWrapper">
                    <div id="searchResultsContainer"></div>
                    <div class="selectionContainer"></div>
                </div>
                <button class="addStocksButton">Add</button>
            </div>
        </div>
        <div class="editMenu">
            <div class="header editHeader">
                <h2>Edit Menu</h2>
                <i class="fas fa-times"></i>
            </div>
            <div class="portfolioNameContainer">
                <label>Portfolio Name</label>
                <input autocomplete="off" spellcheck="false" minlength="1" maxlength="30"
                    value="{{ selected_portfolio.name }}">
            </div>
            <div class="blacklistSourceContainer">
                <div class="header">Blacklist Sources<span class="infoLink"><i class="fas fa-info"></i></span></div>
                <div class="actionWrapper">
                    <input id="textInput" type="text" autocomplete="off" spellcheck="false">
                    <div class="searchResultWrapper">
                        <div id="searchResultsContainer"></div>
                        <div class="selectionContainer">
                            {% for source in selected_portfolio.blacklisted_sources.all %}
                            <div id="blsid#{{source.source_id}}" class="blacklistedSourceContainer">
                                <img src="{% static source.favicon_path %}" alt="Source Picture" />
                                <span>{{ source.name }}</span>
                                <i class="fas fa-times"></i>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="mainPortfolioContainer">
                <label>Main Portfolio</label>
                {% if selected_portfolio.main %}
                <input type="checkbox" checked="True" disabled>
                {% else %}
                <input type="checkbox">
                {% endif %}
                <span class="infoLink"><i class="fas fa-info"></i></span>
            </div>
            <button class="saveEditsButton">Save</button>
            <button class="deletePortfolioButton">Delete Portfolio</button>
        </div>
        <div class="keywordModal">
            <div class="keywordHeader">Keywords for <span></span><i class="fas fa-times"></i>
            </div>
            <div class="createKeywordsContainer">
                <label>Create New Keyword</label>
                <div class="inputContainer">
                    <input minlength="3" maxlength="30" placeholder="Enter keyword..." autocomplete="off"
                        spellcheck="false">
                </div>
                <span class="infoLink"><i class="fas fa-info"></i></span>
            </div>
            <div class="keywordsContainer">
                {% for keyword in stock.keywords %}
                <div id="wkw{{keyword.pkeyword_id }}" class="keywordContainer">
                    <span>{{ keyword.keyword }}</span>
                    <i class="fas fa-times"></i>
                </div>
                {% endfor %}
            </div>
            <button class="addButton">Add</button>
        </div>
        <div class="warningMessageContainer">
            <div class="faTimesContainer">!</div>
            <h3>Warning!</h3>
            <span>Are you sure you want to delete this portfolio? This action can not be undone!</span>
            <div class="buttonContainer"><button class="discardButton">Discard</button><button
                    class="confirmButton">Confirm</button></div>
        </div>
    </div>
</div>

<div class="pageWrapper">
    <div class="firstRow">
        <div class="nameContainer">
            <h2 id="{{ selected_portfolio.portfolio_id }}">{{ selected_portfolio.name }}</h2>
            <i class="fas fa-chevron-down"></i>
            <div class="portfolioOptionsContainer">
                <div class="portfoliosContainer">
                    {% for portfolio in user_portfolios %}
                    <div id="wlist{{portfolio.portfolio_id}}" class="portfolioOption">
                        <span>{{ portfolio.name }}</span>
                        <a href="{{ portfolio.get_absolute_url }}" aria-label="Open portfolio {{ portfolio.name }}"></a>
                    </div>
                    {% endfor %}
                </div>
                <button class="createPortfolioButton"><i class="fas fa-plus"></i>Create New Portfolio</button>
            </div>
        </div>
        <div class="actionButtonContainer">
            <button class="editPortfolioButton"><i class="fas fa-edit"></i><span>Edit</span></button>
            <button class="addStocksButton"><i class="fas fa-plus"></i><span>Add</span></button>
        </div>
    </div>
    {% if stocks|length %}
    <div class="tableWrapper">
        <table>
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>Company</th>
                    <th>Last Content</th>
                    <th>Coverage</th>
                    <th>Keywords</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for stock in stocks %}
                <tr id="pstock{{ stock.pstock_id }}" class="stockContainer">
                    <td>
                        <span class="ticker">{{ stock.stock.ticker }}</span>
                        <a href="{{ stock.absolute_path }}"
                            aria-label="Open Profile Of {{ stock.stock.full_company_name }}"></a>
                    </td>
                    <td class="companyNameContainer">
                        <span>{{ stock.stock.full_company_name }}</span>
                        <a href="{{ stock.absolute_path }}"
                            aria-label="Open Profile Of {{ stock.stock.full_company_name }}"></a>
                    </td>
                    <td>
                        <span>{{ stock.last_article|get_time_since_last_content_published }}</span>
                        <a href="{{ stock.absolute_path }}"
                            aria-label="Open Profile Of {{ stock.stock.full_company_name }}"></a>
                    </td>
                    <td>
                        {% if stock.articles_last_7d < 5 %}
                        <span class="low">Low</span>
                        {% elif stock.articles_last_7d > 5 and stock.articles_last_7d < 10 %}
                        <span class="mid">Mid</span>
                        {% elif stock.articles_last_7d > 10 %}
                        <span class="high">High</span>
                        {% endif %}
                        <a href="{{ stock.absolute_path }}"
                            aria-label="Open Profile Of {{ stock.stock.full_company_name }}"></a>
                    </td>
                    <td>
                        <span class="keywordButton">{{ stock.keywords|length }}</span>
                        <a href="{{ stock.absolute_path }}"
                            aria-label="Open Profile Of {{ stock.stock.full_company_name }}"></a>
                    </td>
                    <td class="actionContainer">
                        <a href="{{ stock.absolute_path }}" class="openStockButton">Open</a>
                        <i class="fa-regular fa-trash-can"></i>
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="tabsContainer" id="content" role="navigation" aria-label="Stock Content Navigation">
        <button class="activatedTab" data-for-tab="0">Analysis</button>
        <button data-for-tab="1">Commentary</button>
        <button data-for-tab="2">News</button>
    </div>
    <div class="tabsContent tabsContentActive" data-tab="0">
        <div class="contentColumnWrapper">
            {% if analysis %}
            <div class="contentColumnContainer">
                {% create_content_container analysis request highlighted_content_ids "analysis" %}
            </div>
            {% else %}
            <div class="emptyInformationContainer">
                <h3>No analytical content found!</h3>
                <div>Consider adding more stocks or keywords to the portfolio!</div>
                <button><i class="fas fa-plus"></i>Add</button>
            </div>
            {% endif %}
        </div>

    </div>
    <div class="tabsContent" data-tab="1">
        <div class="contentColumnWrapper">
            {% if commentary %}
            <div class="contentColumnContainer">
                {% create_content_container commentary request highlighted_content_ids "commentary" %}
            </div>
            {% else %}
            <div class="emptyInformationContainer">
                <h3>No commentary found!</h3>
                <div>Consider adding more stocks or keywords to the portfolio!</div>
                <button><i class="fas fa-plus"></i>Add</button>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="tabsContent" data-tab="2">
        <div class="contentColumnWrapper">
            {% if news %}
            <div class="contentColumnContainer">
                {% create_content_container news request highlighted_content_ids "news" %}
            </div>
            {% else %}
            <div class="emptyInformationContainer">
                <h3>No news content found!</h3>
                <div>Consider adding more stocks or keywords to the portfolio!</div>
                <button><i class="fas fa-plus"></i>Add</button>
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="emptyInformationContainer">
        <h3>This portfolio is empty!</h3>
        <div>Add stocks to this portfolio for analysis, commentary and news on your favorite companies.</div>
        <button><i class="fas fa-plus"></i>Add</button>
    </div>
    {% endif %}
</div>
<script src="{% static 'stock/min_portfolio_script_v2.js' %}"></script>

{% else %}

<main class="main">
    <section class="landingSection">
        <div class="landingSectionContainer">
            <h1>FinBrowser
                <span>Portfolio</span>
            </h1>
            <p>
                get the latest analysis, commentary and news on the stocks in your portfolio.
            </p>
            <a href="{% url 'account_login' %}" class="signUpButton" aria-label="Sign Up">Get Started</a>
        </div>
        <div class="landingSectionImage">
            <img src="{% static 'home/media/landing-page.svg' %}" alt="landing-page-logo">
        </div>
    </section>
</main>

{% endif %}

{% endblock content %}