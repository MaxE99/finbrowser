document.querySelectorAll(".listSubscribeButton").forEach(e=>{e&&e.addEventListener("click",async()=>{if(!e.classList.contains("registrationLink"))try{let t=e.closest(".contentWrapper").id.split("#")[1],s=e.innerText,l=await fetch(`../../api/lists/${t}/list_change_subscribtion_status/`,get_fetch_settings("POST"));if(l.ok){let r=await l.json();console.log(s),"Subscribe"==s?(e.classList.add("listSubscribed"),e.innerText="Subscribed",showMessage(r,"Success")):(e.classList.remove("listSubscribed"),e.innerText="Subscribe",showMessage(r,"Remove"))}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(i){}})}),document.querySelectorAll(".listDeleteButton").forEach(e=>{e.addEventListener("click",async()=>{try{let t=e.closest(".contentWrapper").id.split("#")[1],s=await fetch(`../../api/lists/${t}/`,get_fetch_settings("DELETE"));if(s.ok){let l=await s.json();e.closest(".contentWrapper").remove(),showMessage(l,"Remove")}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(r){}})});let selected_sources=[];document.querySelectorAll(".addSourcesForm #textInput").forEach(e=>{e.addEventListener("keyup",async function(t){let s=e.value,l=e.parentElement.querySelector(".addSourcesForm #searchResultsContainer"),r=e.parentElement.querySelector(".addSourcesForm .selectionContainer");if(s&&""!=s.replaceAll(/\s/g,"")){l.style.display="block",r.style.display="none";try{let i=await fetch(`../../api/sources/?feed_search=${s}`,get_fetch_settings("GET"));if(i.ok){let a=await i.json();l.innerHTML="";let n=document.createElement("div");n.innerText="Results:",l.append(n),a.length>0&&a.forEach(t=>{if(!1==selected_sources.includes(t.source_id)){let s=document.createElement("div");s.classList.add("searchResult");let i=document.createElement("img");i.src=`https://finbrowser.s3.us-east-2.amazonaws.com/static/${t.favicon_path}`;let a=document.createElement("span");a.innerText=t.name,a.id=`fass?si#${t.source_id}`,s.append(i,a),l.appendChild(s),s.addEventListener("click",function i(){s.removeEventListener("click",i),selected_sources.push(t.source_id);let a=document.createElement("i");a.classList.add("fas","fa-trash"),a.addEventListener("click",()=>{a.parentElement.remove(),selected_sources=selected_sources.filter(function(e){return e.toString()!==a.closest(".searchResult").querySelector("span").id.split("#")[1]})}),s.appendChild(a),r.appendChild(s),l.style.display="none",r.style.display="block",e.value=""})}})}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(c){}}else l.style.display="none",r.style.display="block"})}),document.querySelectorAll(".addSourcesForm .formSubmitButton").forEach(e=>{e.addEventListener("click",async()=>{if(selected_sources.length)try{let e=await fetch(`../../api/sources/subscribe_to_sources/${selected_sources}/`,get_fetch_settings("POST"));if(e.ok){let t=await e.json();showMessage(t,"Success"),window.location.reload()}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(s){}else showMessage("You need to select sources!","Error")})});let selected_lists=[];document.querySelectorAll(".addListsForm #textInput").forEach(e=>{e.addEventListener("keyup",async function(t){let s=e.value,l=e.parentElement.querySelector(".addListsForm #searchResultsContainer"),r=e.parentElement.querySelector(".addListsForm .selectionContainer");if(s&&""!=s.replaceAll(/\s/g,"")){l.style.display="block",r.style.display="none";try{let i=await fetch(`../../api/lists/?feed_search=${s}`,get_fetch_settings("GET"));if(i.ok){let a=await i.json();l.innerHTML="";let n=document.createElement("div");n.innerText="Results:",l.append(n),a.length>0&&a.forEach(t=>{if(!1==selected_lists.includes(t.list_id)){let s=document.createElement("div");s.classList.add("searchResult");let i=document.createElement("img");t.list_pic?i.src=t.list_pic:i.src="https://finbrowser.s3.us-east-2.amazonaws.com/static/home/media/finbrowser-bigger-logo.png";let a=document.createElement("span");a.innerText=t.name,a.id=`flls?li#${t.list_id}`,s.append(i,a),l.appendChild(s),s.addEventListener("click",function i(){s.removeEventListener("click",i),selected_lists.push(t.list_id);let a=document.createElement("i");a.classList.add("fas","fa-trash"),a.addEventListener("click",()=>{selected_lists=selected_lists.filter(function(e){return e.toString()!==a.closest(".searchResult").querySelector("span").id.split("#")[1]}),a.parentElement.remove()}),s.appendChild(a),r.appendChild(s),l.style.display="none",r.style.display="block",e.value=""})}})}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(c){}}else l.style.display="none",r.style.display="block"})}),document.querySelectorAll(".addListsForm .formSubmitButton").forEach(e=>{e.addEventListener("click",async()=>{if(selected_lists.length)for(let e=0,t=selected_lists.length;e<t;e++)try{let s=await fetch(`../../api/lists/${selected_lists[e]}/list_change_subscribtion_status/`,get_fetch_settings("POST"));if(s.ok){let l=await s.json();showMessage(l,"Success"),window.location.reload()}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(r){}else showMessage("You need to select lists!","Error")})}),document.querySelector(".tabsContainer .fa-plus").addEventListener("click",()=>{let e=document.querySelector(".activatedTab").innerText;"Your Lists"===e?document.querySelector(".popupContainer .createListPopup .formContainer").style.display="flex":"Subscribed Lists"===e?document.querySelector(".popupContainer .addListsPopup .formContainer").style.display="flex":"Subscribed Sources"===e&&(document.querySelector(".popupContainer .addSourcesPopup .formContainer").style.display="flex"),document.querySelector(".classicMain").style.opacity="0.1",document.querySelector(".popupContainer").style.display="block"}),document.querySelectorAll(".popupContainer .formContainer .closeFormContainerButton").forEach(e=>{e.addEventListener("click",()=>{document.querySelector(".classicMain").style.opacity="1",document.querySelector(".popupContainer").style.display="none",e.closest(".popup").querySelector(".formContainer").style.display="none"})});