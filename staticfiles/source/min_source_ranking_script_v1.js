document.querySelectorAll(".sourceRankingContainer .subscribeButton").forEach(e=>{e.addEventListener("click",async()=>{if(!e.classList.contains("openAuthPrompt"))try{let t=e.closest(".sourceRankingContainer").id.split("#")[1],r=e.innerText,l=await fetch(`../../api/sources/${t}/`,get_fetch_settings("PATCH"));l.ok?"Subscribe"==r?(e.classList.add("subscribed"),e.innerText="Subscribed",showMessage(context="SOURCE HAS BEEN SUBSCRIBED!","Success")):(e.classList.remove("subscribed"),e.innerText="Subscribe",showMessage(context="SOURCE HAS BEEN UNSUBSCRIBED!","Remove")):showMessage("Error: Network request failed unexpectedly!","Error")}catch(n){}})}),document.querySelectorAll(".thirdRow .tag").forEach(e=>e.addEventListener("click",()=>{document.querySelectorAll(".selectedTagsContainer").forEach(t=>{let r=[];if(t.querySelectorAll("li").forEach(e=>{r.push(e.innerText)}),!r.includes(e.innerText)){let l=document.createElement("li");l.classList.add("selectedOption"),l.setAttribute("value",e.innerText),l.innerText=e.innerText;let n=document.createElement("input");n.setAttribute("hidden",!0),n.setAttribute("name","tag"),n.setAttribute("value",e.innerText);let o=document.createElement("i");l.appendChild(n),l.appendChild(o),o.classList.add("fas","fa-times"),o.addEventListener("click",()=>{l.remove()}),t.appendChild(l)}})})),document.querySelectorAll(".selectedTagsContainer li i").forEach(e=>e.addEventListener("click",()=>{e.closest("li").remove()})),document.querySelectorAll("form .tagInputSearch").forEach(e=>e.addEventListener("keypress",function(e){"Enter"===e.key&&e.preventDefault()}));const websiteDropdown=document.querySelectorAll(".filterSidebar form .websiteDropdown, .horizontalFilterMenu form .websiteDropdown").forEach(e=>e.addEventListener("click",t=>{e.closest("form").querySelector(".sectorList").style.display="none",e.closest("form").querySelector(".selectionList").style.display="none","block"!==t.target.querySelector("ul").style.display?t.target.querySelector("ul").style.display="block":t.target.querySelector("ul").style.display="none",document.onclick=function(t){t.target.closest(".websiteList")||t.target===e||(e.querySelector("ul").style.display="none")}})),sectorDropdown=document.querySelectorAll(".filterSidebar form .sectorDropdown, .horizontalFilterMenu form .sectorDropdown").forEach(e=>e.addEventListener("click",t=>{e.closest("form").querySelector(".websiteList").style.display="none",e.closest("form").querySelector(".selectionList").style.display="none","block"!==t.target.querySelector("ul").style.display?t.target.querySelector("ul").style.display="block":t.target.querySelector("ul").style.display="none",document.onclick=function(t){t.target.closest(".sectorList")||t.target===e||(e.querySelector("ul").style.display="none")}}));function selectFilterOption(e){let t=e.closest(".selectContainer"),r=e.closest("form").querySelector(".selectedTagsContainer"),l=e.cloneNode(!0);l.classList.add("selectedOption");let n=document.createElement("i");n.classList.add("fas","fa-times"),n.addEventListener("click",()=>{l.remove()});let o=document.createElement("input");o.setAttribute("hidden",!0),o.setAttribute("name","tag"),o.setAttribute("value",l.innerText),l.appendChild(o),l.appendChild(n),e.style.display="none",r.appendChild(l),r.style.display="flex",t.querySelector("ul").style.display="none"}document.querySelectorAll("form .tagInputSearch").forEach(e=>e.addEventListener("keyup",async function(){let t=e.value,r=e.closest("form").querySelector("#tagAutocomplete_result ul");if(t&&""!=t.replaceAll(/\s/g,"")){try{let l=await fetch(`../../../../../../api/source_tags/?search_term=${t}`,get_fetch_settings("GET"));if(l.ok){let n=await l.json(),o=[];document.querySelectorAll(".selectedTagsContainer li").forEach(e=>o.push(e.innerText)),n.length>0?(r.style.display="block",r.innerHTML="",n.forEach(e=>{if(!o.includes(e.name)){let t=document.createElement("li");t.setAttribute("value",e.name),t.innerText=e.name,t.addEventListener("click",()=>{selectFilterOption(t)}),r.appendChild(t)}})):r.style.display="none"}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(s){}document.onclick=function(e){"autocomplete_list_results"!==e.target.id&&(r.style.display="none")}}else r.style.display="none"})),document.querySelectorAll(".selectionList li").forEach(e=>{e.addEventListener("click",()=>{selectFilterOption(e)})}),document.querySelectorAll("form .selectContainer .dropdown li").forEach(e=>e.addEventListener("click",e=>{e.target.querySelector("input").checked?e.target.querySelector("input").checked=!1:e.target.querySelector("input").checked=!0})),document.querySelectorAll("form .choiceContainer").forEach(e=>e.addEventListener("click",e=>{e.target.querySelector("input").checked?e.target.querySelector("input").checked=!1:e.target.querySelector("input").checked=!0})),document.querySelectorAll(".sourceAddToListButton").forEach(e=>{e.addEventListener("click",e=>{if(setModalStyle(),!e.target.classList.contains("openAuthPrompt")){let t=e.target.closest(".sourceRankingContainer").id.split("#")[1],r=e.target.closest(".sourceRankingContainer").querySelector(".firstRow a span:last-of-type").innerText;document.querySelector(".fullScreenPlaceholder .addToListForm h2 span").innerText=r,document.querySelector(".fullScreenPlaceholder").style.display="flex",document.querySelector(".fullScreenPlaceholder .addSourceToListForm").style.display="block",document.querySelector(".fullScreenPlaceholder .addSourceToListForm").id="source_id"+t;let l=document.querySelectorAll(".fullScreenPlaceholder .listContainer input:first-of-type");l.forEach(e=>{let r=e.closest(".listContainer").querySelector(".sourcesInList").value;JSON.parse(r).includes(parseInt(t))?e.checked=!0:e.checked=!1})}})}),document.querySelector(".openFiltersButton").addEventListener("click",()=>{document.querySelector(".horizontalFilterMenu").style.display="flex",document.querySelector(".pageWrapper").style.opacity="0.1"}),document.querySelector(".horizontalFilterMenu .discardButton").addEventListener("click",()=>{document.querySelector(".horizontalFilterMenu").style.display="none",document.querySelector(".pageWrapper").removeAttribute("style")}),document.querySelectorAll(".sourceRankingContainer .infoContainer .rateSpan").forEach(e=>{e.classList.contains("openAuthPrompt")||e.addEventListener("click",e=>{let t=e.target.closest(".sourceRankingContainer").querySelector(".firstRow a span:last-of-type").innerText,r=e.target.closest(".sourceRankingContainer").id.split("#")[1];document.querySelector(".sourceRatingsWrapper").id=r,document.querySelector(".sourceRatingsWrapper").style.display="flex",document.querySelector(".sourceRatingsWrapper .header h3").innerText="Rate "+t,setModalStyle()})}),document.querySelector(".sourceRatingsWrapper .ratingsContainer .header .fa-times").addEventListener("click",()=>{document.querySelector(".sourceRatingsWrapper").style.display="none",removeModalStyle()});const ratingsButtons=document.querySelectorAll(".sourceRatingsWrapper .ratingsContainer .ratingsButtonContainer button");ratingsButtons.forEach(e=>e.addEventListener("click",()=>{ratingsButtons.forEach(e=>e.classList.remove("selectedRating")),e.classList.add("selectedRating")}));let activatedButton=!1;document.querySelector(".sourceRatingsWrapper .ratingsContainer .rateSourceButton").addEventListener("click",async()=>{let e=document.querySelector(".sourceRatingsWrapper").id,t=document.querySelector(".sourceRatingsWrapper .ratingsContainer .ratingsButtonContainer .selectedRating")?.innerText;if(body={source:e,rating:t},t&&!activatedButton){activatedButton=!0;try{let r=await fetch("../../api/source_ratings/",{method:"POST",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"},mode:"same-origin",body:JSON.stringify(body)});r.ok?(showMessage(context="Rating has been saved!","Success"),window.location.reload()):showMessage("Error: Network request failed unexpectedly!","Error")}catch(l){}}else showMessage("Select a rating!","Error")});
