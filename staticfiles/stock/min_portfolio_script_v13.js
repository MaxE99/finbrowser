async function editPortfolio(){let e=document.querySelector(".editMenu .portfolioNameContainer input").value,o=document.querySelector(".editMenu .mainPortfolioContainer input").checked;if(e.trim().length)try{let t=await fetch(`../../api/portfolios/${PORTFOLIO_ID}/`,{method:"PATCH",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"},mode:"same-origin",body:JSON.stringify({name:e,main:o})});t.ok?(showMessage("Portfolio has been updated!","Success"),window.location.reload()):showMessage("Error: Network request failed unexpectedly!","Error")}catch(r){showMessage("Error: Unexpected error has occurred!","Error")}else showMessage("Please enter a name!","Error")}async function createPortfolio(){try{let e=await fetch("../../api/portfolios/",getFetchSettings("POST"));if(e.ok){let o=await e.json();window.location.replace(`../../portfolio/${o.portfolio_id}`)}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(t){showMessage("Error: Unexpected error has occurred!","Error")}}async function deletePortfolio(){try{let e=await fetch(`../../api/portfolios/${PORTFOLIO_ID}/`,getFetchSettings("DELETE"));e.ok?(showMessage("Portfolio has been deleted!","Remove"),document.querySelectorAll(".portfolioOptionsContainer .portfolioOption").forEach(e=>{let o=e.id.replace("wlist","");o!==PORTFOLIO_ID&&window.location.replace(`../../portfolio/${o}`)})):showMessage("Error: Network request failed unexpectedly!","Error")}catch(o){showMessage("Error: Unexpected error has occurred!","Error")}}async function createPortfolioKeyword(e){let o=document.querySelector(".keywordModal .inputContainer input").value,t=document.querySelector(".keywordModal .keywordHeader span").id.replace("psi","");if(o.trim().length>2&&!isKeywordBeingCreated){isKeywordBeingCreated=!0;try{let r=await fetch("../../api/portfolio_keywords/",{method:"POST",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"},mode:"same-origin",body:JSON.stringify({keyword:o,pstock_id:t})});if(r.ok){let n=await r.json();showNewPortfolioKeywords(n,e,t)}else 403===r.status?(r.json().then(e=>{showMessage(e.detail,"Error")}),isKeywordBeingCreated=!1):showMessage("Error: Network request failed unexpectedly!","Error")}catch(l){showMessage("Error: Unexpected error has occurred!","Error")}}else showMessage("A keyword must have at least 3 letters!","Error")}async function deletePortfolioKeywords(e,o=!1){let t=e.target.closest(".keywordContainer").id.replace("wkw","");try{let r=await fetch(`../../api/portfolio_keywords/${t}/`,getFetchSettings("DELETE"));if(r.ok){if(e.target.closest(".keywordContainer").remove(),showMessage("Keyword has been removed!","Remove"),o)o.innerText-=1;else{let n=document.querySelector(".keywordModal .keywordHeader span").id.replace("psi","");document.querySelectorAll("table tr").forEach(e=>{e.id==`pstock${n}`&&(e.querySelector("td .keywordButton").innerText=parseInt(e.querySelector("td .keywordButton").innerText)-1)})}}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(l){showMessage("Error: Unexpected error has occurred!","Error")}}async function getPortfolioKeywords(e,o){try{let t=await fetch(`../../api/portfolio_stocks/${e}/`,getFetchSettings("GET"));if(t.ok){let r=await t.json();showPortfolioKeywords(r,o)}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(n){showMessage("Error: Unexpected error has occurred!","Error")}}async function addStocksToPortfolio(){if(selectedStocks.length||showMessage("You Need To Select Stocks!","Error"),selectedStocks.length&&!areNewStocksBeingAdded){areNewStocksBeingAdded=!0;try{let e={stocks:selectedStocks,portfolio:PORTFOLIO_ID},o=await fetch("../../api/portfolio_stocks/",{method:"POST",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"},mode:"same-origin",body:JSON.stringify(e)});o.ok?(showMessage("Portfolio has been updated!","Success"),window.location.reload()):403===o.status?(showMessage("Maximum limit of 100 stocks and keywords per portfolio has been reached.","Error"),areNewStocksBeingAdded=!1):showMessage("Error: Network request failed unexpectedly!","Error")}catch(t){showMessage("Error: Unexpected error has occurred!","Error")}}}async function removeStockFromPortfolio(e){let o=e.closest(".stockContainer").id.replace("pstock","");try{let t=await fetch(`../../api/portfolio_stocks/${o}/`,getFetchSettings("DELETE"));t.ok?(showMessage("Stock has been removed!","Remove"),e.closest(".stockContainer").remove(),document.querySelector("table .stockContainer")||window.location.reload()):showMessage("Error: Network request failed unexpectedly!","Error")}catch(r){showMessage("Error: Unexpected error has occurred!","Error")}}async function addSourceToBlacklist(e,o,t){try{let r={source_id:e.source_id},n=await fetch(`../../api/portfolios/${PORTFOLIO_ID}/`,{method:"PATCH",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"},mode:"same-origin",body:JSON.stringify(r)});n.ok?showNewBlacklistedSources(o,t,e):showMessage("Error: Network request failed unexpectedly!","Error")}catch(l){showMessage("Error: Unexpected error has occurred!","Error")}}async function removeSourceFromBlacklist(e){let o=e.closest(".blacklistedSourceContainer").id.split("#")[1];try{let t=await fetch(`../../api/portfolios/${PORTFOLIO_ID}/`,{method:"PATCH",headers:{"X-CSRFToken":getCookie("csrftoken"),Accept:"application/json","Content-Type":"application/json"},mode:"same-origin",body:JSON.stringify({source_id:o})});t.ok?(e.closest(".blacklistedSourceContainer").remove(),blacklistedSources=blacklistedSources.filter(e=>e!==o)):showMessage("Error: Network request failed unexpectedly!","Error")}catch(r){showMessage("Error: Unexpected error has occurred!","Error")}}async function searchForNotBlacklistedSources(e,o,t){try{let r=await fetch(`../../api/sources/?blacklist_search=${e}&portfolio_id=${PORTFOLIO_ID}`,getFetchSettings("GET"));if(r.ok){let n=await r.json();showBlacklistSearchResults(o,t,n)}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(l){showMessage("Error: Unexpected error has occurred!","Error")}}async function searchForNewPortfolioStocks(e,o,t,r,n){try{let l=await fetch(`../../api/stocks/?search_term=${e}`,getFetchSettings("GET"));if(l.ok){let i=await l.json();showPortfolioStocksSearchResults(o,i,t,r,n)}else showMessage("Error: Network request failed unexpectedly!","Error")}catch(a){showMessage("Error: Unexpected error has occurred!","Error")}}function changePortfolio(){let e=document.querySelector(".firstRow .nameContainer i"),o=document.querySelector(".portfolioOptionsContainer"),t="block"===o.style.display;o.style.display=t?"none":"block",e.classList.toggle("fa-chevron-up",!t),e.classList.toggle("fa-chevron-down",t)}function sortKeywords(e){return e.sort((e,o)=>e.keyword.toUpperCase().localeCompare(o.keyword.toUpperCase())),e}function openEditPortfolioMenu(){document.querySelector(".portfolioMenuWrapper").style.display="block",document.querySelector(".editMenu").style.display="block",setModalStyle()}function closeEditPortfolioMenu(){document.querySelector(".portfolioMenuWrapper").style.display="none",document.querySelector(".editMenu").style.display="none",removeModalStyle()}function openPortfolioKeywordsMenu(e){setModalStyle(),document.querySelector(".portfolioMenuWrapper").style.display="block",document.querySelector(".portfolioMenuWrapper .keywordModal").style.display="block";let o=e.closest("tr").id.replace("pstock","");document.querySelector(".keywordHeader span").innerText=e.closest("tr").querySelector(".ticker").innerText,document.querySelector(".keywordHeader span").id="psi"+o,getPortfolioKeywords(o,e)}function closePortfolioKeywordsMenu(){removeModalStyle(),document.querySelector(".portfolioMenuWrapper").style.display="none",document.querySelector(".portfolioMenuWrapper .keywordModal").style.display="none"}function openPortfolioKeywordExplanation(e){document.querySelector(".portfolioMenuWrapper").style.display="none",e.closest(".keywordModal").style.display="none",createExplanationContainer("Keywords","FinBrowser finds content related to the stocks in your portfolio based on their ticker symbol and company name. If you want to see content that focuses on a specific product or segment within a company, you can enter a keyword here and the results for that keyword will be displayed as well. For instance, let's say you hold Amazon stock and you want to see more information about their cloud computing platform, AWS. Simply enter AWS as your keyword and you'll get all the relevant results. It's that easy!"),document.querySelector(".fullScreenPlaceholder .fullScreenWrapper .explanationContainer .fa-times").addEventListener("click",()=>closePortfolioKeywordExplanation(e),{once:!0})}function closePortfolioKeywordExplanation(e){document.querySelector(".portfolioMenuWrapper").style.display="block",e.closest(".keywordModal").style.display="block",document.querySelector(".fullScreenPlaceholder .explanationContainer").style.display="none"}function openBlacklistExplanation(){document.querySelector(".portfolioMenuWrapper").style.display="none",document.querySelector(".portfolioMenuWrapper .editMenu").style.display="none",createExplanationContainer("Blacklist Sources","If you're seeing content from sources that you don't find helpful or relevant, you can easily remove them from your feed by adding them to your blacklisted sources. By doing so, you'll no longer see content from those sources and can focus on the ones that are most helpful to you."),document.querySelector(".fullScreenPlaceholder .fullScreenWrapper .explanationContainer .fa-times").addEventListener("click",()=>closeBlacklistExplanation(),{once:!0})}function closeBlacklistExplanation(){document.querySelector(".fullScreenPlaceholder .explanationContainer").style.display="none",document.querySelector(".portfolioMenuWrapper").style.display="flex",document.querySelector(".portfolioMenuWrapper .editMenu").style.display="block"}function openPortfolioDeletionWarning(){document.querySelector(".portfolioMenuWrapper").style.display="none",document.querySelector(".editMenu").style.display="none",document.querySelector(".portfolioMenuWrapper").style.display="block",document.querySelector(".portfolioMenuWrapper .warningMessageContainer").style.display="flex",document.querySelector(".portfolioMenuWrapper .warningMessageContainer .discardButton").addEventListener("click",()=>closePortfolioDeletionWarning())}function closePortfolioDeletionWarning(){removeModalStyle(),document.querySelector(".portfolioMenuWrapper").style.display="none",document.querySelector(".portfolioMenuWrapper .warningMessageContainer").style.display="none"}function openMainPortfolioExplanation(){document.querySelector(".portfolioMenuWrapper").style.display="none",document.querySelector(".portfolioMenuWrapper .editMenu").style.display="none",createExplanationContainer("Main Portfolio","Your main portfolio is the one that opens up whenever you click on the Portfolio button in the header. It's important to note that you always need to have at least one main portfolio. If you only have one portfolio, then you won't be able to delete it as it is your main one. But, if you have multiple portfolios and you delete your main one, then the next portfolio in alphabetical order will become your new main portfolio. Don't worry though, you can easily change your main portfolio by opening the edit menu of a portfolio that is currently not your main one and setting it as your new main portfolio. It's as simple as that!"),document.querySelector(".fullScreenPlaceholder .fullScreenWrapper .explanationContainer .fa-times").addEventListener("click",()=>closeBlacklistExplanation(),{once:!0})}function closeAddStocksToPortfolioMenu(){document.querySelector(".portfolioMenuWrapper").style.display="none",document.querySelector(".addStocksContainer").style.display="none",removeModalStyle()}function startPortfolioDeletionProcess(){1===document.querySelectorAll(".portfoliosContainer .portfolioOption").length?showMessage("You are not allowed to delete your last portfolio!","Error"):(openPortfolioDeletionWarning(),document.querySelector(".portfolioMenuWrapper .warningMessageContainer .confirmButton").addEventListener("click",()=>deletePortfolio(),{once:!0}))}function showNewBlacklistedSources(e,o,t){document.querySelector(".blacklistSourceContainer #textInput").value="",e.style.display="none",o.style.display="block",blacklistedSources.push(t.source_id);let r=document.createElement("div");r.classList.add("blacklistedSourceContainer"),r.id=`blsid#${t.source_id}`;let n=document.createElement("img");n.src=`https://finbrowser.s3.us-east-2.amazonaws.com/static/${t.favicon_path}`;let l=document.createElement("span");l.innerText=t.name;let i=document.createElement("i");i.classList.add("fas","fa-times"),i.addEventListener("click",()=>removeSourceFromBlacklist(r)),r.append(n,l,i),o.appendChild(r)}function showBlacklistSearchResults(e,o,t){e.innerHTML="";let r=document.createElement("div");r.innerText="Results:",e.append(r),t.length>0&&t.forEach(t=>{if(!blacklistedSources.includes(t.source_id)){let r=document.createElement("div");r.classList.add("searchResult");let n=document.createElement("img");n.src=`https://finbrowser.s3.us-east-2.amazonaws.com/static/${t.favicon_path}`;let l=document.createElement("span");l.innerText=t.name,l.id=`source_id_${t.source_id}`,r.append(n,l),e.appendChild(r),r.addEventListener("click",()=>addSourceToBlacklist(t,e,o))}})}function showPortfolioStocksSearchResults(e,o,t,r,n){e.innerHTML="";let l=document.createElement("div");l.classList.add("resultHeader"),l.innerText="Results:",e.append(l),o.length>0&&o.forEach(o=>{if(!selectedStocks.includes(o.stock_id)&&!t.includes(o.ticker)){let l=document.createElement("div");l.classList.add("searchResult");let i=document.createElement("div");i.classList.add("stockContainer");let a=document.createElement("div");a.innerText=o.ticker,a.id="pssi#"+o.stock_id,a.classList.add("stockTicker");let c=document.createElement("div");c.innerText=o.full_company_name,c.classList.add("companyName"),i.append(a,c),l.appendChild(i),e.appendChild(l),l.addEventListener("click",function t(){l.removeEventListener("click",t),selectedStocks.push(o.stock_id);let i=document.createElement("i");i.classList.add("fas","fa-times"),i.addEventListener("click",()=>{i.parentElement.remove(),selectedStocks=selectedStocks.filter(function(e){return e.toString()!==i.closest(".searchResult").querySelector(".stockTicker").id.split("#")[1]})}),l.appendChild(i),r.appendChild(l),e.style.display="none",r.style.display="block",n.value=""})}})}function resetAddStocksToPortfolioMenu(e){selectedStocks=[],e.innerHTML=""}function openAddStocksToPortfolioMenu(){document.querySelector(".portfolioMenuWrapper").style.display="block",document.querySelector(".addStocksContainer").style.display="block",setModalStyle(),document.querySelector(".addStocksContainer #addStocks").addEventListener("keyup",function(e){let o=[],t=document.querySelectorAll("table tr .ticker");for(let r=0,n=t.length;r<n;r++)o.push(t[r].innerText);let l=document.querySelector(".addStocksContainer #addStocks"),i=l.value,a=e.target.closest(".addStocksContainer").querySelector("#searchResultsContainer"),c=e.target.closest(".addStocksContainer").querySelector(".selectionContainer");document.querySelector(".addStocksContainer .buttonContainer .cancelButton").addEventListener("click",()=>resetAddStocksToPortfolioMenu(c));let s=""!==i?.split(/\s+/).join("");a.style.display=s?"block":"none",c.style.display=s?"none":"block",s&&searchForNewPortfolioStocks(i,a,o,c,l)})}function showNewPortfolioKeywords(e,o,t){let r=document.createElement("div");r.classList.add("keywordContainer"),r.id=`wkw${e.pkeyword_id}`;let n=document.createElement("span");n.innerText=e.keyword;let l=document.createElement("i");l.addEventListener("click",e=>deletePortfolioKeywords(e)),l.classList.add("fas","fa-times"),r.append(n,l),o.closest(".keywordModal").querySelector(".keywordsContainer").appendChild(r),o.closest(".keywordModal").querySelector(".inputContainer input").value="",isKeywordBeingCreated=!1,showMessage("Keyword has been added!","Success"),document.querySelectorAll("table tr").forEach(e=>{e.id==`pstock${t}`&&(e.querySelector("td .keywordButton").innerText=parseInt(e.querySelector("td .keywordButton").innerText)+1)})}function showPortfolioKeywords(e,o){let t=sortKeywords(e.keywords),r=document.querySelector(".portfolioMenuWrapper .keywordModal .keywordsContainer");r.innerHTML="",t.forEach(e=>{let t=document.createElement("div");t.classList.add("keywordContainer"),t.id="wkw"+e.pkeyword_id;let n=document.createElement("span");n.innerText=e.keyword;let l=document.createElement("i");l.addEventListener("click",e=>deletePortfolioKeywords(e,o)),l.classList.add("fas","fa-times"),t.append(n,l),r.appendChild(t)})}function startBlacklistSearchProcess(){let e=document.querySelector(".blacklistSourceContainer #textInput").value,o=document.querySelector(".blacklistSourceContainer #searchResultsContainer"),t=document.querySelector(".blacklistSourceContainer .selectionContainer"),r=e&&""!==e.split(/\s+/).join("");o.style.display=r?"block":"none",t.style.display=r?"none":"block",r&&searchForNotBlacklistedSources(e,o,t)}function changeTabsOnPageOpen(e){let o=document.querySelectorAll(".pageWrapper .tabsContainer button"),t=document.querySelectorAll(".pageWrapper .tabsContent");for(let r=0,n=o.length;r<n;r++)o[r].classList.remove("activatedTab"),t[r].classList.remove("tabsContentActive");o[e].classList.add("activatedTab"),t[e].classList.add("tabsContentActive")}location.href.includes("?commentary=")&&changeTabsOnPageOpen(1),location.href.includes("?news=")&&changeTabsOnPageOpen(2);let selectedStocks=[],isKeywordBeingCreated=!1,areNewStocksBeingAdded=!1,blacklistedSources=[];document.querySelectorAll(".blacklistSourceContainer .blacklistedSourceContainer").forEach(e=>blacklistedSources.push(e.id.split("#")[1]));const PORTFOLIO_ID=document.querySelector(".firstRow .nameContainer h2").id;document.querySelector(".firstRow .nameContainer").addEventListener("click",()=>changePortfolio()),document.querySelector(".createPortfolioButton").addEventListener("click",()=>createPortfolio(),{once:!0}),document.querySelector(".actionButtonContainer .addStocksButton").addEventListener("click",()=>openAddStocksToPortfolioMenu()),document.querySelectorAll(".emptyInformationContainer button").forEach(e=>e.addEventListener("click",()=>openAddStocksToPortfolioMenu())),document.querySelector(".addStocksContainer .closeAddStockContainer").addEventListener("click",()=>closeAddStocksToPortfolioMenu()),document.querySelector(".editPortfolioButton").addEventListener("click",()=>openEditPortfolioMenu()),document.querySelector(".editMenu .fa-times").addEventListener("click",()=>closeEditPortfolioMenu()),document.querySelector(".portfolioMenuWrapper .addStocksContainer .addStocksButton").addEventListener("click",()=>addStocksToPortfolio()),document.querySelectorAll(".blacklistSourceContainer .blacklistedSourceContainer .fa-times").forEach(e=>e.addEventListener("click",()=>removeSourceFromBlacklist(e))),document.querySelectorAll(".stockContainer td .keywordButton").forEach(e=>e.addEventListener("click",()=>openPortfolioKeywordsMenu(e))),document.querySelectorAll(".keywordModal .addButton").forEach(e=>e.addEventListener("click",e=>createPortfolioKeyword(e.target))),document.querySelectorAll(".keywordModal .createKeywordsContainer input").forEach(e=>e.addEventListener("keypress",function(o){"Enter"===o.key&&createPortfolioKeyword(e)})),document.querySelector(".portfolioMenuWrapper .keywordModal .keywordHeader .fa-times").addEventListener("click",()=>closePortfolioKeywordsMenu()),document.querySelector(".portfolioMenuWrapper .keywordModal .createKeywordsContainer .infoLink i").addEventListener("click",e=>openPortfolioKeywordExplanation(e.target)),document.querySelector(".portfolioMenuWrapper .editMenu .blacklistSourceContainer .header .infoLink i").addEventListener("click",()=>openBlacklistExplanation()),document.querySelector(".portfolioMenuWrapper .editMenu .mainPortfolioContainer .infoLink i").addEventListener("click",()=>openMainPortfolioExplanation()),document.querySelector(".blacklistSourceContainer #textInput").addEventListener("keyup",()=>startBlacklistSearchProcess()),document.querySelector(".editMenu .deletePortfolioButton").addEventListener("click",()=>startPortfolioDeletionProcess()),document.querySelectorAll(".stockContainer .fa-trash-can").forEach(e=>{e.addEventListener("click",e=>removeStockFromPortfolio(e.target))}),document.querySelector(".menuContainer .editMenu .saveEditsButton").addEventListener("click",()=>editPortfolio(),{once:!0});
